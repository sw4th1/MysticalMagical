<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>My Spotify Profile</title>
    <script src="src/script.ts" type="module"></script>
    <style>
      button {
        margin-top: 1em;
        padding: 0.5em 1em;
        font-size: 1rem;
        cursor: pointer;
      }
      #topTracks {
        margin-top: 1.5em;
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Display your Spotify profile data</h1>

    <section id="profile">
      <h2>Logged in as <span id="displayName"></span></h2>
      <span id="avatar"></span>
      <ul>
        <li>User ID: <span id="id"></span></li>
        <li>Email: <span id="email"></span></li>
        <li>Spotify URI: <a id="uri" href="#"></a></li>
        <li>Link: <a id="url" href="#"></a></li>
        <li>Profile Image: <span id="imgUrl"></span></li>
      </ul>
      <button id="fetchTopTracks">See Top 50 Songs</button>
    </section>

    <section id="topTracks">
      <h3>Top 50 Songs</h3>
      <ul id="trackList"></ul>
    </section>

    <script type="module">
      import { getAccessToken } from "./src/script.ts";

      document.getElementById("fetchTopTracks")?.addEventListener("click", async () => {
        const token = localStorage.getItem("access_token");
        if (!token) return alert("No token found.");

        const res = await fetch("http://127.0.0.1:3000/get_tracks", {
          headers: { Authorization: `Bearer ${token}` },
        });
        const data = await res.json();

        const list = document.getElementById("trackList");
        list.innerHTML = "";
        Object.values(data.tracks).forEach((track) => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${track.name}</strong> - ${track.artist_names.join(", ")}`;
          list.appendChild(li);
        });

        document.getElementById("topTracks").style.display = "block";
      });
    </script>
  </body>
</html>
